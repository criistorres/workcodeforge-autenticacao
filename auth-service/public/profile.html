<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil - WorkAdventure Auth</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë§</text></svg>">
</head>
<body>
    <div class="profile-container">
        <div class="container">
            <!-- Header do perfil -->
            <div class="profile-header fade-in">
                <div class="profile-avatar" data-user-name></div>
                <h1 class="profile-name" data-user-name></h1>
                <p class="profile-email" data-user-email></p>
                
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value" data-user-username></div>
                        <div class="stat-label">Username</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tags-count">0</div>
                        <div class="stat-label">Tags</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="account-status">Ativo</div>
                        <div class="stat-label">Status</div>
                    </div>
                </div>
            </div>

            <!-- Formul√°rio de edi√ß√£o de perfil -->
            <div class="auth-card fade-in" style="margin-bottom: 2rem;">
                <div class="auth-header">
                    <h2 class="auth-title">Editar Perfil</h2>
                    <p class="auth-subtitle">Atualize suas informa√ß√µes pessoais</p>
                </div>

                <form data-auth-form="profile" novalidate>
                    <div class="form-group">
                        <label for="name" class="form-label">Nome Completo</label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-input" 
                            data-validate="name"
                            placeholder="Seu nome completo"
                            required
                            autocomplete="name"
                        >
                    </div>

                    <div class="form-group">
                        <label for="username" class="form-label">Username</label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username" 
                            class="form-input" 
                            data-validate="username"
                            placeholder="seu_username"
                            required
                            autocomplete="username"
                        >
                        <div class="form-help">Apenas letras, n√∫meros e underscore</div>
                    </div>

                    <div class="form-group">
                        <label for="tags" class="form-label">Tags</label>
                        <div class="tags-container" id="user-tags">
                            <!-- Tags ser√£o carregadas dinamicamente -->
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <input 
                                type="text" 
                                id="tag-input" 
                                class="form-input tag-input" 
                                placeholder="Adicionar tag"
                            >
                            <button type="button" id="add-tag-btn" class="btn btn-secondary" style="width: auto; padding: 0.75rem 1rem;">
                                Adicionar
                            </button>
                        </div>
                        <div class="form-help">Tags ajudam a personalizar sua experi√™ncia</div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        Salvar Altera√ß√µes
                    </button>
                </form>
            </div>

            <!-- Formul√°rio de altera√ß√£o de senha -->
            <div class="auth-card fade-in" style="margin-bottom: 2rem;">
                <div class="auth-header">
                    <h2 class="auth-title">Alterar Senha</h2>
                    <p class="auth-subtitle">Mantenha sua conta segura</p>
                </div>

                <form data-auth-form="change-password" novalidate>
                    <div class="form-group">
                        <label for="currentPassword" class="form-label">Senha Atual</label>
                        <input 
                            type="password" 
                            id="currentPassword" 
                            name="currentPassword" 
                            class="form-input" 
                            placeholder="Sua senha atual"
                            required
                            autocomplete="current-password"
                        >
                    </div>

                    <div class="form-group">
                        <label for="newPassword" class="form-label">Nova Senha</label>
                        <input 
                            type="password" 
                            id="newPassword" 
                            name="newPassword" 
                            class="form-input" 
                            data-validate="password"
                            placeholder="Nova senha"
                            required
                            autocomplete="new-password"
                        >
                        <div class="form-help">
                            M√≠nimo 8 caracteres, incluindo: letra min√∫scula, mai√∫scula, n√∫mero e caractere especial
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmNewPassword" class="form-label">Confirmar Nova Senha</label>
                        <input 
                            type="password" 
                            id="confirmNewPassword" 
                            name="confirmNewPassword" 
                            class="form-input" 
                            data-validate="confirmPassword"
                            placeholder="Confirme a nova senha"
                            required
                            autocomplete="new-password"
                        >
                    </div>

                    <button type="submit" class="btn btn-primary">
                        Alterar Senha
                    </button>
                </form>
            </div>

            <!-- A√ß√µes da conta -->
            <div class="auth-card fade-in">
                <div class="auth-header">
                    <h2 class="auth-title">A√ß√µes da Conta</h2>
                </div>

                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <button type="button" id="logout-btn" class="btn btn-danger">
                        Sair da Conta
                    </button>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <a href="/login.html" class="auth-link">Voltar ao Login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script>
        // Carregar dados do perfil quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                window.location.href = '/login.html';
                return;
            }

            try {
                const response = await fetch('/auth/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    const user = result.data;
                    
                    // Preencher formul√°rios com dados do usu√°rio
                    document.getElementById('name').value = user.name || '';
                    document.getElementById('username').value = user.username || '';
                    
                    // Atualizar avatar com primeira letra do nome
                    const avatar = document.querySelector('.profile-avatar');
                    if (avatar && user.name) {
                        avatar.textContent = user.name.charAt(0).toUpperCase();
                    }
                    
                    // Atualizar contador de tags
                    const tagsCount = document.getElementById('tags-count');
                    if (tagsCount) {
                        tagsCount.textContent = (user.tags || []).length;
                    }
                    
                    // Renderizar tags
                    const tagsContainer = document.getElementById('user-tags');
                    if (tagsContainer && user.tags) {
                        window.authApp.renderTags(tagsContainer, user.tags);
                    }
                } else {
                    localStorage.removeItem('auth_token');
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                localStorage.removeItem('auth_token');
                window.location.href = '/login.html';
            }
        });
    </script>
</body>
</html>
